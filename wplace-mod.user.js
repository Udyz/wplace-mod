// ==UserScript==
// @name         wplace-mod
// @namespace    https://github.com/Udyz
// @version      1.0.0
// @description  Fake Admin Wplace
// @icon         data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAAXNSR0IArs4c6QAAABJQTFRFAQEBAAAAHGHnRcxVStlbMXLnk8SHtQAAAAF0Uk5TAEDm2GYAAABMSURBVHjadc9JCgAhDERRa7r/lZs0ikawdv+tkvEYALS07U2QawmOTo1oQBKr8/cUMLY7JLEPYLW0oISSNLtgiojRBfv0AuB67vH3B+FjAY/0rrGiAAAAAElFTkSuQmCC
// @match        https://wplace.live/*
// @match        https://backend.wplace.live/*
// @run-at       document-start
// @grant        none
// ==/UserScript==

(function(){"use strict";const toInject=function(){const t="backend.wplace.live";new Set;const e=t=>{const e=t.match(/s(\d+)\/pixel\/(\d+)\/(\d+)\?x=(\d+)&y=(\d+)/);return e?{season:e[1],tileX:e[2],tileY:e[3],pixelX:e[4],pixelY:e[5]}:null},n=t=>{if(!t)return;const e=document.querySelector("body > div > div.disable-pinch-zoom.relative.h-full.overflow-hidden.svelte-6wmtgk > div.absolute.bottom-0.left-0.z-50.w-full.sm\\:left-1\\/2.sm\\:max-w-md.sm\\:-translate-x-1\\/2.md\\:max-w-lg");if(!e)return;const n=e.querySelector("#bm-h");n&&n.remove();const s=document.createElement("span");s.id="bm-h",s.style.marginLeft="calc(var(--spacing)*3)",s.style.fontSize="small",s.style.display="block",s.style.marginTop="8px",s.textContent=`(Tl X: ${t.tileX}, Tl Y: ${t.tileY}, Px X: ${t.pixelX}, Px Y: ${t.pixelY})`;const r=e.querySelector(".rounded-t-box.bg-base-100.border-base-300");if(r){const t=r.querySelector(".flex.gap-2");t?t.parentNode.insertBefore(s,t.nextSibling):r.appendChild(s)}else e.appendChild(s)},s=t=>{try{t.role="admin",t.banned=!1,t.isCustomer=!0}catch(t){}return t},r=e=>{if(!e)return!1;try{const n=new URL(String(e));return n.hostname.includes(t)&&"/me"===n.pathname}catch(n){return String(e).includes(t)&&String(e).includes("/me")}},o=e=>{try{if(!e)return e;let n=String(e);return/\/moderator\/s\d+\/pixel\//.test(n)&&(n=n.replace(t+"/moderator/",t+"/")),n}catch(t){return e}};try{const i=window.fetch;window.fetch=async function(a,c){let l;try{l="string"==typeof a?a:a&&a.url?a.url:String(a)}catch(t){l=""}if(l=o(l),"string"==typeof a?a=l:a&&a.url&&(a=new Request(l,a)),r(l))try{const t=await i.apply(this,arguments);let e={};try{e=await t.json()}catch(t){e={}}return e=s(e),new Response(JSON.stringify(e),{status:200,headers:{"Content-Type":"application/json"}})}catch(t){}const d=await i.apply(this,arguments);try{const s=d.url||l||"";if((e=>!!e&&String(e).includes(t))(s)&&403===d.status){const t=await d.arrayBuffer().catch((()=>null)),e=function(t){const e={};try{for(const n of t.entries())e[n[0].toLowerCase()]=n[1]}catch(t){}return e}(d.headers||new Headers);return new Response(t,{status:200,statusText:"OK",headers:e})}const r=e(s);r&&setTimeout((()=>n(r)),100)}catch(t){}return d}}catch(t){}try{const t=XMLHttpRequest.prototype.open,i=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(e,n,s,r,i){return n=o(n),this.__hook_me={method:e,url:n,async:s,user:r,password:i,headers:{}},t.call(this,e,n,s,r,i)};const a=XMLHttpRequest.prototype.setRequestHeader;XMLHttpRequest.prototype.setRequestHeader=function(t,e){try{this.__hook_me.headers[t]=e}catch(t){}return a.apply(this,arguments)},XMLHttpRequest.prototype.send=function(t){const o=this.__hook_me;if(!o||!o.url)return i.apply(this,arguments);const a=String(o.url);if(r(a))return void(async()=>{try{const e=await fetch(a,{method:o.method||"GET",headers:o.headers||{},body:t||null,credentials:this.withCredentials?"include":"same-origin"});let n={};try{n=await e.json()}catch(t){n={}}n=s(n);const r=JSON.stringify(n);this.readyState=4,this.status=200,Object.defineProperty(this,"responseText",{value:r}),Object.defineProperty(this,"response",{value:r}),this.dispatchEvent(new Event("readystatechange")),this.dispatchEvent(new Event("load")),this.dispatchEvent(new Event("loadend"))}catch(t){this.readyState=4,this.status=500,"function"==typeof this.onerror&&this.onerror(t),this.dispatchEvent(new Event("error")),this.dispatchEvent(new Event("loadend"))}})();const c=e(a);return c&&setTimeout((()=>n(c)),100),i.apply(this,arguments)}}catch(t){}};try{const t=document.createElement("script");t.textContent="("+toInject.toString()+")();",(document.documentElement||document.head||document.body).prepend(t)}catch(t){}})();
